@* Componente de paginação reutilizável *@

<div class="flex justify-between items-center mt-6">
    <div class="text-sm text-gray-600">
        Mostrando @StartRecord a @EndRecord de @TotalRecords registros
    </div>
    <div class="flex gap-2">
        <button @onclick="OnPreviousPage" 
                disabled="@(CurrentPage == 1)" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            <i class="fa-solid fa-chevron-left mr-2"></i>
            Anterior
        </button>
        
        @if (ShowPageNumbers)
        {
            <div class="flex gap-1">
                @for (int i = StartPage; i <= EndPage; i++)
                {
                    var pageNum = i; // Capture variable for lambda
                    <button @onclick="@(() => OnPageChange(pageNum))" 
                            class="@GetPageButtonClass(pageNum)">
                        @pageNum
                    </button>
                }
            </div>
        }
        
        <button @onclick="OnNextPage" 
                disabled="@(CurrentPage >= TotalPages)" 
                class="px-4 py-2 border border-gray-300 rounded-lg text-gray-700 hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed transition-colors">
            Próxima
            <i class="fa-solid fa-chevron-right ml-2"></i>
        </button>
    </div>
</div>

@code {
    [Parameter]
    public int CurrentPage { get; set; } = 1;

    [Parameter]
    public int TotalRecords { get; set; }

    [Parameter]
    public int PageSize { get; set; } = 10;

    [Parameter]
    public bool ShowPageNumbers { get; set; } = true;

    [Parameter]
    public EventCallback<int> OnPageChanged { get; set; }

    private int TotalPages => (int)Math.Ceiling((double)TotalRecords / PageSize);
    private int StartRecord => TotalRecords == 0 ? 0 : (CurrentPage - 1) * PageSize + 1;
    private int EndRecord => Math.Min(CurrentPage * PageSize, TotalRecords);

    private int StartPage
    {
        get
        {
            var start = Math.Max(1, CurrentPage - 2);
            return Math.Min(start, Math.Max(1, TotalPages - 4));
        }
    }

    private int EndPage => Math.Min(TotalPages, StartPage + 4);

    private async Task OnPreviousPage()
    {
        if (CurrentPage > 1)
        {
            await OnPageChanged.InvokeAsync(CurrentPage - 1);
        }
    }

    private async Task OnNextPage()
    {
        if (CurrentPage < TotalPages)
        {
            await OnPageChanged.InvokeAsync(CurrentPage + 1);
        }
    }

    private async Task OnPageChange(int page)
    {
        if (page != CurrentPage)
        {
            await OnPageChanged.InvokeAsync(page);
        }
    }

    private string GetPageButtonClass(int page)
    {
        var baseClass = "px-3 py-2 border rounded-lg transition-colors";
        return page == CurrentPage
            ? $"{baseClass} bg-orange-500 text-white border-orange-500"
            : $"{baseClass} border-gray-300 text-gray-700 hover:bg-gray-50";
    }
}
